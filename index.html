<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calm Space</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --mint:#6fd3c4;
  --mint-soft:rgba(111,211,196,0.25);
  --glass:rgba(255,255,255,0.07);
}
html,body{
  margin:0;
  height:100%;
  background:radial-gradient(circle at top,#081615,#020807);
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  color:#eaf8f4;
  overflow:hidden;
}
canvas{position:fixed;inset:0}

.ui{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
.panel{
  width:92%;
  max-width:760px;
  padding:44px;
  border-radius:36px;
  background:linear-gradient(180deg,rgba(255,255,255,0.09),rgba(255,255,255,0.03));
  backdrop-filter:blur(30px);
  box-shadow:0 40px 120px rgba(0,0,0,0.45);
  text-align:center;
}
h1{
  font-weight:500;
  letter-spacing:0.5px;
  margin-bottom:12px;
}
.sub{
  opacity:0.75;
  font-size:15px;
  margin-bottom:28px;
}
.game{
  min-height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:22px;
}
button{
  margin-top:30px;
  padding:14px 42px;
  border-radius:999px;
  border:none;
  background:linear-gradient(135deg,#7de3d4,#4fbdb0);
  color:#04221d;
  font-size:16px;
  cursor:pointer;
}
button:active{transform:scale(0.97)}
.hidden{display:none}

/* Interaction visuals */
.orb{
  width:130px;
  height:130px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#c8fff5,#4fbdb0);
  box-shadow:0 0 80px var(--mint-soft);
  transition:transform 1.5s ease;
}
.hold{
  transition:none;
}
.trace{
  width:100%;
  height:160px;
  border-radius:24px;
  background:rgba(255,255,255,0.05);
  position:relative;
}
.path{
  position:absolute;
  inset:20px;
  border:2px dashed rgba(255,255,255,0.15);
  border-radius:100px;
}
</style>
</head>
<body>

<canvas id="aurora"></canvas>

<div class="ui">
  <div class="panel">
    <h1>Calm Space</h1>
    <div class="sub">Move slowly. Thereâ€™s nothing to finish.</div>
    <div class="game" id="game"></div>
    <button id="next">Begin Session</button>
  </div>
</div>

<script>
/* ===== AUDIO (unchanged, stable) ===== */
let audioCtx, masterGain;
function startAudio(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  masterGain=audioCtx.createGain();
  masterGain.gain.value=0.03;
  masterGain.connect(audioCtx.destination);

  for(let i=0;i<4;i++){
    const o=audioCtx.createOscillator();
    o.frequency.value=60+Math.random()*80;
    const g=audioCtx.createGain();
    g.gain.value=0;
    o.connect(g).connect(masterGain);
    o.start();
    g.gain.linearRampToValueAtTime(1,audioCtx.currentTime+5);
  }
}

/* ===== CALM GESTURE GAMES ===== */
const gameEl=document.getElementById("game");
const nextBtn=document.getElementById("next");

const games=[
  // Hold
  ()=>{
    gameEl.innerHTML=`
      <div>Press and hold the light.</div>
      <div class="orb hold" id="holdOrb"></div>
    `;
    const orb=document.getElementById("holdOrb");
    orb.onpointerdown=()=>orb.style.transform="scale(1.4)";
    orb.onpointerup=orb.onpointerleave=()=>orb.style.transform="scale(1)";
  },

  // Drag
  ()=>{
    gameEl.innerHTML=`
      <div>Gently drag the orb.</div>
      <div class="orb" id="dragOrb"></div>
    `;
    const orb=document.getElementById("dragOrb");
    let down=false;
    orb.onpointerdown=()=>down=true;
    document.onpointerup=()=>down=false;
    document.onpointermove=e=>{
      if(down){
        orb.style.transform=`translate(${e.movementX}px,${e.movementY}px)`;
      }
    };
  },

  // Trace
  ()=>{
    gameEl.innerHTML=`
      <div>Trace the path slowly.</div>
      <div class="trace">
        <div class="path"></div>
      </div>
    `;
  },

  // Stillness
  ()=>{
    gameEl.innerHTML=`
      <div>Do nothing for a moment.</div>
      <div class="orb"></div>
    `;
  }
];

let index=-1;
nextBtn.onclick=()=>{
  if(index===-1){
    startAudio();
    nextBtn.innerText="Next";
  }
  index++;
  if(index>=games.length){
    gameEl.innerHTML="Stay as long as you like.";
    nextBtn.classList.add("hidden");
    return;
  }
  games[index]();
};

/* ===== AURORA ===== */
const c=document.getElementById("aurora");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();onresize=resize;
let t=0;
function draw(){
  t+=0.002;
  ctx.clearRect(0,0,c.width,c.height);
  for(let i=0;i<3;i++){
    const y=c.height*(0.3+i*0.2);
    ctx.beginPath();
    ctx.moveTo(0,y);
    for(let x=0;x<c.width;x+=40){
      ctx.lineTo(x,y+Math.sin(x*0.002+t*2+i)*80);
    }
    ctx.strokeStyle="rgba(111,211,196,0.18)";
    ctx.lineWidth=140;
    ctx.stroke();
  }
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
